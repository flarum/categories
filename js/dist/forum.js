(()=>{var t={762:()=>{},379:(t,e,s)=>{"use strict";s.d(e,{l:()=>Mt});const a=flarum.reg.get("core","forum/app");var r=s.n(a);function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function i(t,e,s){return(e=function(t){var e=function(t,e){if("object"!==n(t)||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var a=s.call(t,e);if("object"!==n(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"===n(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const o=flarum.reg.get("core","common/app");var l=s.n(o);class c{constructor(){i(this,"loadedIncludes",void 0)}async load(t){if(void 0===t&&(t=[]),!this.loadedIncludes)return this.query(t);const e=t.filter((t=>!this.loadedIncludes.has(t)));return 0===e.length?Promise.resolve(l().store.all("tags")):this.query(e)}async query(t){return void 0===t&&(t=[]),null!=this.loadedIncludes||(this.loadedIncludes=new Set),l().store.find("tags",{include:t.join(",")}).then((e=>(t.forEach((t=>this.loadedIncludes.add(t))),e)))}}flarum.reg.add("flarum-tags","common/states/TagListState",c);const u=flarum.reg.get("core","common/extend"),d=flarum.reg.get("core","forum/components/IndexPage");var g=s.n(d);const h=flarum.reg.get("core","common/components/Separator");var p=s.n(h);const f=flarum.reg.get("core","common/components/LinkButton");var y=s.n(f);const T=flarum.reg.get("core","common/components/Link");var b=s.n(T);const v=flarum.reg.get("core","common/utils/classList");var x=s.n(v);function N(t,e,s){void 0===e&&(e={}),void 0===s&&(s={});const a=t&&t.icon(),{useColor:r=!0}=s;return e.className=x()([e.className,"icon",a?t.icon():"TagIcon"]),t&&r?(e.style=e.style||{},e.style["--color"]=t.color(),a&&(e.style.color=t.color())):t||(e.className+=" untagged"),a?m("i",e):m("span",e)}flarum.reg.add("flarum-tags","common/helpers/tagIcon",N);class w extends(y()){view(t){const e=this.attrs.model,s=e&&e.description(),a=x()("TagLinkButton hasIcon",{child:e.isChild()},this.attrs.className);return m(b(),{className:a,href:this.attrs.route,style:e?{"--color":e.color()}:void 0,title:s||void 0},N(e,{className:"Button-icon"}),m("span",{className:"Button-label"},e?e.name():app.translator.trans("flarum-tags.forum.index.untagged_link")))}static initAttrs(t){super.initAttrs(t);const e=t.model;t.params.tags=e?e.slug():"untagged",t.route=app.route("tag",t.params)}}flarum.reg.add("flarum-tags","forum/components/TagLinkButton",w);const _=flarum.reg.get("core","common/components/Page");var I=s.n(_);const S=flarum.reg.get("core","common/components/LoadingIndicator");var C=s.n(S);const P=flarum.reg.get("core","common/helpers/listItems");var D=s.n(P);const L=flarum.reg.get("core","common/utils/ItemList");var k=s.n(L);const A=flarum.reg.get("core","common/helpers/humanTime");var R=s.n(A);const M=flarum.reg.get("core","common/helpers/textContrastClass");var q=s.n(M);const B=flarum.reg.get("core","common/utils/extract");var E=s.n(B);function O(t,e){void 0===e&&(e={}),e.style=e.style||{},e.className="TagLabel "+(e.className||"");const s=E()(e,"link"),a=t?t.name():app.translator.trans("flarum-tags.lib.deleted_tag_text");if(t){const a=t.color();a&&(e.style["--tag-bg"]=a,e.className=x()(e.className,"colored",q()(a))),s&&(e.title=t.description()||"",e.href=app.route("tag",{tags:t.slug()})),t.isChild()&&(e.className+=" TagLabel--child")}else e.className+=" untagged";return m(s?b():"span",e,m("span",{className:"TagLabel-text"},t&&t.icon()&&N(t,{className:"TagLabel-icon"},{useColor:!1}),m("span",{className:"TagLabel-name"},a)))}function H(t){return t.slice(0).sort(((t,e)=>{const s=t.position(),a=e.position();if(null===s&&null===a)return e.discussionCount()-t.discussionCount();if(null===a)return-1;if(null===s)return 1;const r=t.parent(),n=e.parent();return r===n?s-a:r&&n?r.position()-n.position():r?r===e?1:r.position()-a:n?n===t?-1:s-n.position():0}))}flarum.reg.add("flarum-tags","common/helpers/tagLabel",O),flarum.reg.add("flarum-tags","common/utils/sortTags",H);class j extends(I()){oninit(t){super.oninit(t),app.history.push("tags",app.translator.trans("flarum-tags.forum.header.back_to_tags_tooltip")),this.tags=[];const e=app.preloadedApiDocument();e?this.tags=H(e.filter((t=>!t.isChild()))):(this.loading=!0,app.tagList.load(["children","lastPostedDiscussion","parent"]).then((()=>{this.tags=H(app.store.all("tags").filter((t=>!t.isChild()))),this.loading=!1,m.redraw()})))}oncreate(t){super.oncreate(t),app.setTitle(app.translator.trans("flarum-tags.forum.all_tags.meta_title_text")),app.setTitleCount(0)}view(){return m("div",{className:"TagsPage"},this.pageContent().toArray())}pageContent(){const t=new(k());return t.add("hero",this.hero(),100),t.add("main",m("div",{className:"container"},this.mainContent().toArray()),10),t}mainContent(){const t=new(k());return t.add("sidebar",this.sidebar(),100),t.add("content",this.content(),10),t}content(){return m("div",{className:"TagsPage-content sideNavOffset"},this.contentItems().toArray())}contentItems(){const t=new(k());if(this.loading)t.add("loading",m(C(),null));else{const e=this.tags.filter((t=>null!==t.position())),s=this.tags.filter((t=>null===t.position()));t.add("tagTiles",this.tagTileListView(e),100),s.length&&t.add("cloud",this.cloudView(s),10)}return t}hero(){return g().prototype.hero()}sidebar(){return m("nav",{className:"TagsPage-nav IndexPage-nav sideNav"},m("ul",null,D()(this.sidebarItems().toArray())))}sidebarItems(){return g().prototype.sidebarItems()}tagTileListView(t){return m("ul",{className:"TagTiles"},t.map(this.tagTileView.bind(this)))}tagTileView(t){const e=t.lastPostedDiscussion(),s=H(t.children()||[]);return m("li",{className:x()("TagTile",{colored:t.color()},q()(t.color())),style:{"--tag-bg":t.color()}},m(b(),{className:"TagTile-info",href:app.route.tag(t)},t.icon()&&N(t,{},{useColor:!1}),m("h3",{className:"TagTile-name"},t.name()),m("p",{className:"TagTile-description"},t.description()),!!s&&m("div",{className:"TagTile-children"},s.map((t=>[m(b(),{href:app.route.tag(t)},t.name())," "])))),e?m(b(),{className:"TagTile-lastPostedDiscussion",href:app.route.discussion(e,e.lastPostNumber())},m("span",{className:"TagTile-lastPostedDiscussion-title"},e.title()),R()(e.lastPostedAt())):m("span",{className:"TagTile-lastPostedDiscussion"}))}cloudView(t){return m("div",{className:"TagCloud"},t.map((t=>[O(t,{link:!0})," "])))}}flarum.reg.add("flarum-tags","forum/components/TagsPage",j);const V=flarum.reg.get("core","forum/states/DiscussionListState");var F=s.n(V);const K=flarum.reg.get("core","forum/states/GlobalSearchState");var $=s.n(K);const U=flarum.reg.get("core","common/Component");var z=s.n(U);class G extends(z()){view(){const t=this.attrs.model,e=t.color();return m("header",{className:x()("Hero","TagHero",{"TagHero--colored":e,[q()(e)]:e}),style:e?{"--hero-bg":e}:void 0},m("div",{className:"container"},m("div",{className:"containerNarrow"},m("h1",{className:"Hero-title"},t.icon()&&N(t,{},{useColor:!1})," ",t.name()),m("div",{className:"Hero-subtitle"},t.description()))))}}flarum.reg.add("flarum-tags","forum/components/TagHero",G);const J=t=>r().store.all("tags").find((e=>0===e.slug().localeCompare(t,void 0,{sensitivity:"base"}))),Q=flarum.reg.get("core","forum/components/DiscussionListItem");var W=s.n(Q);const X=flarum.reg.get("core","forum/components/DiscussionHero");var Y=s.n(X);function Z(t,e){void 0===e&&(e={});const s=[],{link:a,...r}=e;return r.className=x()("TagsLabel",r.className),t?H(t).forEach((e=>{(e||1===t.length)&&s.push(O(e,{link:a}))})):s.push(O()),m("span",r,s)}flarum.reg.add("flarum-tags","common/helpers/tagsLabel",Z);const tt=flarum.reg.get("core","forum/utils/DiscussionControls");var et=s.n(tt);const st=flarum.reg.get("core","common/components/Button");var at=s.n(st);const rt=flarum.reg.get("core","forum/components/DiscussionPage");var nt=s.n(rt);const it=flarum.reg.get("core","common/utils/extractText");var ot=s.n(it);function lt(t){let e=app.store.all("tags");return e=t?e.filter((e=>e.canAddToDiscussion()||-1!==t.tags().indexOf(e))):e.filter((t=>t.canStartDiscussion())),e}flarum.reg.add("flarum-tags","forum/utils/getSelectableTags",lt);const ct=flarum.reg.get("core","common/helpers/highlight");var mt=s.n(ct);const ut=flarum.reg.get("core","common/utils/KeyboardNavigatable");var dt=s.n(ut);const gt=flarum.reg.get("core","common/components/Modal");var ht=s.n(gt);const pt=flarum.reg.get("core","common/utils/Stream");var ft=s.n(pt);class yt extends(z()){view(t){const{className:e,isToggled:s,...a}=this.attrs,r=s?"far fa-check-circle":"far fa-circle";return m(at(),Object.assign({},a,{icon:r,className:x()([e,s&&"Button--toggled"])}),t.children)}}flarum.reg.add("flarum-tags","forum/components/ToggleButton",yt);class Tt extends(ht()){constructor(){super(...arguments),i(this,"loading",!0),i(this,"tags",void 0),i(this,"selected",[]),i(this,"bypassReqs",!1),i(this,"filter",ft()("")),i(this,"focused",!1),i(this,"navigator",new(dt())),i(this,"indexTag",void 0)}static initAttrs(t){var e,s,a,r,n,i,o,c,m,u,d,g,h,p,f,y,T,b;super.initAttrs(t),t.title||(t.title=ot()(l().translator.trans("flarum-tags.lib.tag_selection_modal.title"))),t.canSelect||(t.canSelect=()=>!0),null!=t.allowResetting||(t.allowResetting=!0),t.limits={min:{total:null!=(e=null==(s=t.limits)||null==(a=s.min)?void 0:a.total)?e:-1/0,primary:null!=(r=null==(n=t.limits)||null==(i=n.min)?void 0:i.primary)?r:-1/0,secondary:null!=(o=null==(c=t.limits)||null==(m=c.min)?void 0:m.secondary)?o:-1/0},max:{total:null!=(u=null==(d=t.limits)||null==(g=d.max)?void 0:g.total)?u:1/0,primary:null!=(h=null==(p=t.limits)||null==(f=p.max)?void 0:f.primary)?h:1/0,secondary:null!=(y=null==(T=t.limits)||null==(b=T.max)?void 0:b.secondary)?y:1/0}},function(t){if(t.min.primary>t.max.primary)throw new Error("The minimum number of primary tags allowed cannot be more than the maximum number of primary tags allowed.");if(t.min.secondary>t.max.secondary)throw new Error("The minimum number of secondary tags allowed cannot be more than the maximum number of secondary tags allowed.");if(t.min.total>t.max.primary+t.max.secondary)throw new Error("The minimum number of tags allowed cannot be more than the maximum number of primary and secondary tags allowed together.");if(t.max.total<t.min.primary+t.min.secondary)throw new Error("The maximum number of tags allowed cannot be less than the minimum number of primary and secondary tags allowed together.");if(t.min.total>t.max.total)throw new Error("The minimum number of tags allowed cannot be more than the maximum number of tags allowed.")}(t.limits)}oninit(t){super.oninit(t),this.navigator.onUp((()=>this.setIndex(this.getCurrentNumericIndex()-1,!0))).onDown((()=>this.setIndex(this.getCurrentNumericIndex()+1,!0))).onSelect(this.select.bind(this)).onRemove((()=>this.selected.splice(this.selected.length-1,1))),l().tagList.load(["parent"]).then((t=>{this.loading=!1,this.attrs.selectableTags&&(t=this.attrs.selectableTags(t)),this.tags=H(t),this.attrs.selectedTags&&this.attrs.selectedTags.map(this.addTag.bind(this)),this.indexTag=t[0],m.redraw()}))}className(){return x()("TagSelectionModal",this.attrs.className)}title(){return this.attrs.title}content(){if(this.loading||!this.tags)return m(C(),null);const t=this.filter().toLowerCase(),e=this.primaryCount(),s=this.secondaryCount(),a=this.getFilteredTags(),r=Math.max(ot()(this.getInstruction(e,s)).length,this.filter().length);return[m("div",{className:"Modal-body"},m("div",{className:"TagSelectionModal-form"},m("div",{className:"TagSelectionModal-form-input"},m("div",{className:"TagsInput FormControl "+(this.focused?"focus":""),onclick:()=>this.$(".TagsInput input").focus()},m("span",{className:"TagsInput-selected"},this.selected.map((t=>m("span",{className:"TagsInput-tag",onclick:()=>{this.removeTag(t),this.onready()}},O(t))))),m("input",{className:"FormControl",placeholder:ot()(this.getInstruction(e,s)),bidi:this.filter,style:{width:r+"ch"},onkeydown:this.navigator.navigate.bind(this.navigator),onfocus:()=>this.focused=!0,onblur:()=>this.focused=!1}))),m("div",{className:"TagSelectionModal-form-submit App-primaryControl"},m(at(),{type:"submit",className:"Button Button--primary",disabled:!this.meetsRequirements(e,s),icon:"fas fa-check"},l().translator.trans("flarum-tags.lib.tag_selection_modal.submit_button"))))),m("div",{className:"Modal-footer"},m("ul",{className:"TagSelectionModal-list SelectTagList"},a.map((e=>m("li",{"data-index":e.id(),className:x()({pinned:null!==e.position(),child:!!e.parent(),colored:!!e.color(),selected:this.selected.includes(e),active:this.indexTag===e}),style:{color:e.color()},onmouseover:()=>this.indexTag=e,onclick:this.toggleTag.bind(this,e)},N(e),m("span",{className:"SelectTagListItem-name"},mt()(e.name(),t)),e.description()?m("span",{className:"SelectTagListItem-description"},e.description()):"")))),this.attrs.limits.allowBypassing&&m("div",{className:"TagSelectionModal-controls"},m(yt,{className:"Button",onclick:()=>this.bypassReqs=!this.bypassReqs,isToggled:this.bypassReqs},l().translator.trans("flarum-tags.lib.tag_selection_modal.bypass_requirements"))))]}getFilteredTags(){const t=this.filter().toLowerCase(),e=this.primaryCount(),s=this.secondaryCount();let a=this.tags;return this.attrs.requireParentTag&&(a=a.filter((t=>{const e=t.parent();return null!==e&&(!1===e||this.selected.includes(e))}))),this.bypassReqs||(this.selected.length>=this.attrs.limits.max.total?a=a.filter((t=>this.selected.includes(t))):(e>=this.attrs.limits.max.primary&&(a=a.filter((t=>!t.isPrimary()||this.selected.includes(t)))),s>=this.attrs.limits.max.secondary&&(a=a.filter((t=>t.isPrimary()||this.selected.includes(t)))))),t&&(a=a.filter((e=>e.name().toLowerCase().includes(t)))),this.indexTag&&a.includes(this.indexTag)||(this.indexTag=a[0]),a}primaryCount(){return this.selected.filter((t=>t.isPrimary())).length}secondaryCount(){return this.selected.filter((t=>!t.isPrimary())).length}meetsRequirements(t,e){return!!(this.bypassReqs||this.attrs.allowResetting&&0===this.selected.length)||!(this.selected.length<this.attrs.limits.min.total)&&t>=this.attrs.limits.min.primary&&e>=this.attrs.limits.min.secondary}addTag(t){if(t&&this.attrs.canSelect(t)){if(this.attrs.onSelect&&this.attrs.onSelect(t,this.selected),this.attrs.requireParentTag){const e=t.parent();e&&!this.selected.includes(e)&&this.selected.push(e)}this.selected.includes(t)||this.selected.push(t)}}removeTag(t){const e=this.selected.indexOf(t);-1!==e&&(this.selected.splice(e,1),this.attrs.requireParentTag&&this.selected.filter((e=>e.parent()===t)).forEach(this.removeTag.bind(this)),this.attrs.onDeselect&&this.attrs.onDeselect(t,this.selected))}toggleTag(t){this.tags&&(this.selected.includes(t)?this.removeTag(t):this.addTag(t),this.filter()&&(this.filter(""),this.indexTag=this.tags[0]),this.onready())}getInstruction(t,e){if(this.bypassReqs)return"";if(t<this.attrs.limits.min.primary){const e=this.attrs.limits.min.primary-t;return ot()(l().translator.trans("flarum-tags.lib.tag_selection_modal.choose_primary_placeholder",{count:e}))}if(e<this.attrs.limits.min.secondary){const t=this.attrs.limits.min.secondary-e;return ot()(l().translator.trans("flarum-tags.lib.tag_selection_modal.choose_secondary_placeholder",{count:t}))}if(this.selected.length<this.attrs.limits.min.total){const t=this.attrs.limits.min.total-this.selected.length;return ot()(l().translator.trans("flarum-tags.lib.tag_selection_modal.choose_tags_placeholder",{count:t}))}return""}onsubmit(t){t.preventDefault(),this.attrs.onsubmit&&this.attrs.onsubmit(this.selected),this.hide()}select(t){t.metaKey||t.ctrlKey||this.indexTag&&this.selected.includes(this.indexTag)?this.selected.length&&this.$('button[type="submit"]').click():this.indexTag&&this.getItem(this.indexTag)[0].dispatchEvent(new Event("click"))}selectableItems(){return this.$(".TagSelectionModal-list > li")}getCurrentNumericIndex(){return this.indexTag?this.selectableItems().index(this.getItem(this.indexTag)):-1}getItem(t){return this.selectableItems().filter('[data-index="'.concat(t.id(),'"]'))}setIndex(t,e){const s=this.selectableItems(),a=s.parent();t<0?t=s.length-1:t>=s.length&&(t=0);const r=s.eq(t);if(this.indexTag=l().store.getById("tags",r.attr("data-index")),m.redraw(),e&&this.indexTag){const t=a.scrollTop(),e=a.offset().top,s=e+a.outerHeight(),n=r.offset().top,i=n+r.outerHeight();let o;n<e?o=t-e+n-parseInt(a.css("padding-top"),10):i>s&&(o=t-s+i+parseInt(a.css("padding-bottom"),10)),void 0!==o&&a.stop(!0).animate({scrollTop:o},100)}}}flarum.reg.add("flarum-tags","common/components/TagSelectionModal",Tt);class bt extends Tt{static initAttrs(t){var e;super.initAttrs(t);const s=t.discussion?r().translator.trans("flarum-tags.forum.choose_tags.edit_title",{title:m("em",null,t.discussion.title())}):r().translator.trans("flarum-tags.forum.choose_tags.title");t.className=x()(t.className,"TagDiscussionModal"),t.title=ot()(s),t.allowResetting=!!r().forum.attribute("canBypassTagCounts"),t.limits={allowBypassing:t.allowResetting,max:{primary:r().forum.attribute("maxPrimaryTags"),secondary:r().forum.attribute("maxSecondaryTags")},min:{primary:r().forum.attribute("minPrimaryTags"),secondary:r().forum.attribute("minSecondaryTags")}},t.requireParentTag=!0,t.selectableTags=()=>lt(t.discussion),null!=t.selectedTags||(t.selectedTags=(null==(e=t.discussion)?void 0:e.tags())||[]),t.canSelect=t=>t.canStartDiscussion();const a=t.onsubmit||null;t.onsubmit=function(e){const s=t.discussion;s&&s.save({relationships:{tags:e}}).then((()=>{r().current.matches(nt())&&r().current.get("stream").update(),m.redraw()})),a&&a(e)}}}flarum.reg.add("flarum-tags","forum/components/TagDiscussionModal",bt);const vt=flarum.reg.get("core","forum/components/DiscussionComposer");var xt=s.n(vt);const Nt=flarum.reg.get("core","common/extenders");var wt=s.n(Nt);const _t=flarum.reg.get("core","common/models/Discussion");var It=s.n(_t);const St=flarum.reg.get("core","forum/components/EventPost");var Ct=s.n(St);class Pt extends(Ct()){static initAttrs(t){super.initAttrs(t);const e=t.post.content()[0],s=t.post.content()[1];function a(t,e){return t.filter((t=>-1===e.indexOf(t))).map((t=>app.store.getById("tags",t)))}t.tagsAdded=a(s,e),t.tagsRemoved=a(e,s)}icon(){return"fas fa-tag"}descriptionKey(){return this.attrs.tagsAdded.length?this.attrs.tagsRemoved.length?"flarum-tags.forum.post_stream.added_and_removed_tags_text":"flarum-tags.forum.post_stream.added_tags_text":"flarum-tags.forum.post_stream.removed_tags_text"}descriptionData(){const t={};return this.attrs.tagsAdded.length&&(t.tagsAdded=app.translator.trans("flarum-tags.forum.post_stream.tags_text",{tags:Z(this.attrs.tagsAdded,{link:!0}),count:this.attrs.tagsAdded.length})),this.attrs.tagsRemoved.length&&(t.tagsRemoved=app.translator.trans("flarum-tags.forum.post_stream.tags_text",{tags:Z(this.attrs.tagsRemoved,{link:!0}),count:this.attrs.tagsRemoved.length})),t}}flarum.reg.add("flarum-tags","forum/components/DiscussionTaggedPost",Pt);const Dt=flarum.reg.get("core","common/utils/computed");var Lt=s.n(Dt);const kt=flarum.reg.get("core","common/Model");var At=s.n(kt);class Rt extends(At()){name(){return At().attribute("name").call(this)}slug(){return At().attribute("slug").call(this)}description(){return At().attribute("description").call(this)}color(){return At().attribute("color").call(this)}backgroundUrl(){return At().attribute("backgroundUrl").call(this)}backgroundMode(){return At().attribute("backgroundMode").call(this)}icon(){return At().attribute("icon").call(this)}position(){return At().attribute("position").call(this)}parent(){return At().hasOne("parent").call(this)}children(){return At().hasMany("children").call(this)}defaultSort(){return At().attribute("defaultSort").call(this)}isChild(){return At().attribute("isChild").call(this)}isHidden(){return At().attribute("isHidden").call(this)}discussionCount(){return At().attribute("discussionCount").call(this)}lastPostedAt(){return At().attribute("lastPostedAt",At().transformDate).call(this)}lastPostedDiscussion(){return At().hasOne("lastPostedDiscussion").call(this)}isRestricted(){return At().attribute("isRestricted").call(this)}canStartDiscussion(){return At().attribute("canStartDiscussion").call(this)}canAddToDiscussion(){return At().attribute("canAddToDiscussion").call(this)}isPrimary(){return Lt()("position","parent",((t,e)=>null!==t&&!1===e)).call(this)}}flarum.reg.add("flarum-tags","common/models/Tag",Rt);const Mt=[(new(wt().Store)).add("tags",Rt),(new(wt().Routes)).add("tags","/tags",j).add("tag","/t/:tags",g()).helper("tag",(t=>r().route("tag",{tags:t.slug()}))),(new(wt().PostTypes)).add("discussionTagged",Pt),new(wt().Model)(It()).hasMany("tags").attribute("canTag")];r().initializers.add("flarum-tags",(function(){r().tagList=new c,(0,u.extend)(g().prototype,"navItems",(function(t){if(t.add("tags",m(y(),{icon:"fas fa-th-large",href:r().route("tags")},r().translator.trans("flarum-tags.forum.index.tags_link")),-10),r().current.matches(j))return;t.add("separator",m(p(),null),-12);const e=r().search.stickyParams(),s=r().store.all("tags"),a=this.currentTag(),n=s=>{let r=a===s;!r&&a&&(r=a.parent()===s),t.add("tag"+s.id(),m(w,{model:s,params:e,active:r},null==s?void 0:s.name()),-14)};H(s).filter((t=>null!==t.position()&&(!t.isChild()||a&&(t.parent()===a||t.parent()===a.parent())))).forEach(n);const i=s.filter((t=>null===t.position())).sort(((t,e)=>e.discussionCount()-t.discussionCount()));i.splice(0,3).forEach(n),i.length&&t.add("moreTags",m(y(),{href:r().route("tags")},r().translator.trans("flarum-tags.forum.index.more_link")),-16)})),g().prototype.currentTag=function(){if(this.currentActiveTag)return this.currentActiveTag;const t=r().search.params().tags;let e=null;if(t&&(e=J(t)),t&&!e||e&&!e.isChild()&&!e.children()){if(this.currentTagLoading)return;this.currentTagLoading=!0,r().store.find("tags",t,{include:"children,children.parent,parent,state"}).then((()=>{this.currentActiveTag=J(t),m.redraw()})).finally((()=>{this.currentTagLoading=!1}))}return e?(this.currentActiveTag=e,this.currentActiveTag):void 0},(0,u.override)(g().prototype,"hero",(function(t){const e=this.currentTag();return e?m(G,{model:e}):t()})),(0,u.extend)(g().prototype,"view",(function(t){const e=this.currentTag();e&&(t.attrs.className+=" IndexPage--tag"+e.id())})),(0,u.extend)(g().prototype,"setTitle",(function(){const t=this.currentTag();t&&r().setTitle(t.name())})),(0,u.extend)(g().prototype,"sidebarItems",(function(t){const e=this.currentTag();if(e){const s=e.color(),a=e.canStartDiscussion()||!r().session.user,n=t.get("newDiscussion");s&&(n.attrs.className=x()([n.attrs.className,"Button--tagColored",q()(s)]),n.attrs.style={"--color":s}),n.attrs.disabled=!a,n.children=r().translator.trans(a?"core.forum.index.start_discussion_button":"core.forum.index.cannot_start_discussion_button")}})),(0,u.extend)($().prototype,"params",(function(t){t.tags=m.route.param("tags")})),(0,u.extend)(F().prototype,"requestParams",(function(t){var e;if("string"==typeof t.include?t.include=[t.include]:null==(e=t.include)||e.push("tags","tags.parent"),this.params.tags){var s;const e=null!=(s=t.filter)?s:{};e.tag=this.params.tags;const a=e.q;a&&(e.q="".concat(a," tag:").concat(this.params.tags)),t.filter=e}})),(0,u.extend)(W().prototype,"infoItems",(function(t){const e=this.attrs.discussion.tags();e&&e.length&&t.add("tags",Z(e),10)})),(0,u.extend)(Y().prototype,"view",(function(t){const e=H(this.attrs.discussion.tags());if(e&&e.length){const s=e[0].color();s&&(t.attrs.style={"--hero-bg":s},t.attrs.className=x()(t.attrs.className,"DiscussionHero--colored",q()(s)))}})),(0,u.extend)(Y().prototype,"items",(function(t){const e=this.attrs.discussion.tags();e&&e.length&&t.add("tags",Z(e,{link:!0}),5)})),(0,u.extend)(et(),"moderationControls",(function(t,e){e.canTag()&&t.add("tags",m(at(),{icon:"fas fa-tag",onclick:()=>app.modal.show(bt,{discussion:e})},app.translator.trans("flarum-tags.forum.discussion_controls.edit_tags_button")))})),(0,u.extend)(g().prototype,"newDiscussionAction",(function(t){const e=this.currentTag();if(e){const s=e.parent(),a=s?[s,e]:[e];t.then((t=>t.fields.tags=a))}else app.composer.fields.tags=[]})),(0,u.extend)(xt().prototype,"oninit",(function(){app.tagList.load(["parent"]).then((()=>m.redraw()))})),xt().prototype.chooseTags=function(){lt().length&&app.modal.show(bt,{selectedTags:(this.composer.fields.tags||[]).slice(0),onsubmit:t=>{this.composer.fields.tags=t,this.$("textarea").focus()}})},(0,u.extend)(xt().prototype,"headerItems",(function(t){const e=this.composer.fields.tags||[],s=lt();t.add("tags",m("a",{className:x()(["DiscussionComposer-changeTags",!s.length&&"disabled"]),onclick:this.chooseTags.bind(this)},e.length?Z(e):m("span",{className:"TagLabel untagged"},app.translator.trans("flarum-tags.forum.composer_discussion.choose_tags_link"))),10)})),(0,u.override)(xt().prototype,"onsubmit",(function(t){const e=this.composer.fields.tags||[],s=e.filter((t=>null!==t.position()&&!t.isChild())),a=e.filter((t=>null===t.position())),r=lt(),n=parseInt(app.forum.attribute("minPrimaryTags")),i=parseInt(app.forum.attribute("minSecondaryTags")),o=parseInt(app.forum.attribute("maxPrimaryTags")),l=parseInt(app.forum.attribute("maxSecondaryTags"));(!e.length&&0!==o&&0!==l||s.length<n||a.length<i)&&r.length?app.modal.show(bt,{selectedTags:e,onsubmit:e=>{this.composer.fields.tags=e,t()}}):t()})),(0,u.extend)(xt().prototype,"data",(function(t){t.relationships=t.relationships||{},t.relationships.tags=this.composer.fields.tags}))}))}},e={};function s(a){var r=e[a];if(void 0!==r)return r.exports;var n=e[a]={exports:{}};return t[a](n,n.exports,s),n.exports}s.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return s.d(e,{a:e}),e},s.d=(t,e)=>{for(var a in e)s.o(e,a)&&!s.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var a={};(()=>{"use strict";s.r(a),s.d(a,{extend:()=>r.l});var t=s(762),e={};for(const s in t)"default"!==s&&(e[s]=()=>t[s]);s.d(a,e);var r=s(379)})(),module.exports=a})();
//# sourceMappingURL=forum.js.map